{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Phase 1 Complete Database Schema v3.0",
  "description": "完全版database.jsonのスキーマ定義",
  "type": "object",
  "required": [
    "metadata",
    "case_info",
    "evidence",
    "phase1_progress"
  ],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "データベースメタデータ",
      "required": [
        "database_version",
        "case_id",
        "last_updated"
      ],
      "properties": {
        "database_version": {
          "type": "string",
          "const": "3.0",
          "description": "データベース構造バージョン"
        },
        "case_id": {
          "type": "string",
          "description": "事件ID"
        },
        "case_name": {
          "type": "string",
          "description": "事件名"
        },
        "case_number": {
          "type": "string",
          "description": "事件番号"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "データベース作成日時（ISO 8601形式）"
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "最終更新日時（ISO 8601形式）"
        },
        "last_phase": {
          "type": "string",
          "description": "最後に実行したPhase"
        },
        "last_action": {
          "type": "string",
          "description": "最後に実行したアクション"
        },
        "next_recommended_action": {
          "type": "string",
          "description": "次に推奨されるアクション"
        },
        "gdrive_database_id": {
          "type": [
            "string",
            "null"
          ],
          "description": "Google Drive上のdatabase.jsonのファイルID"
        },
        "system_version": {
          "type": "string",
          "description": "Phase 1システムバージョン"
        }
      }
    },
    "case_info": {
      "type": "object",
      "description": "事件情報",
      "properties": {
        "case_name": {
          "type": "string"
        },
        "case_number": {
          "type": "string"
        },
        "case_type": {
          "type": "string"
        },
        "court": {
          "type": "string"
        },
        "plaintiff": {
          "type": "string"
        },
        "defendant": {
          "type": "string"
        },
        "filing_date": {
          "type": [
            "string",
            "null"
          ],
          "format": "date"
        },
        "case_summary": {
          "type": "string"
        }
      }
    },
    "evidence": {
      "type": "array",
      "description": "証拠リスト",
      "items": {
        "$ref": "#/definitions/evidence_item"
      }
    },
    "phase1_progress": {
      "type": "array",
      "description": "Phase 1進捗記録",
      "items": {
        "type": "object",
        "properties": {
          "task": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": [
              "completed",
              "in_progress",
              "error"
            ]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "details": {
            "type": "object"
          }
        }
      }
    }
  },
  "definitions": {
    "evidence_item": {
      "type": "object",
      "description": "証拠アイテム（完全版）",
      "required": [
        "evidence_id",
        "evidence_number",
        "complete_metadata",
        "phase1_complete_analysis"
      ],
      "properties": {
        "evidence_id": {
          "type": "string",
          "description": "証拠ID（例: ko070）"
        },
        "evidence_number": {
          "type": "string",
          "description": "証拠番号（例: 甲070）"
        },
        "original_filename": {
          "type": "string",
          "description": "元のファイル名"
        },
        "evidence_type": {
          "type": "string",
          "enum": [
            "our",
            "opponent"
          ],
          "description": "証拠タイプ"
        },
        "registered_at": {
          "type": "string",
          "format": "date-time",
          "description": "登録日時"
        },
        "complete_metadata": {
          "$ref": "#/definitions/complete_metadata"
        },
        "phase1_complete_analysis": {
          "$ref": "#/definitions/phase1_complete_analysis"
        }
      }
    },
    "complete_metadata": {
      "type": "object",
      "description": "完全メタデータ",
      "properties": {
        "basic": {
          "type": "object",
          "properties": {
            "file_name": {
              "type": "string"
            },
            "file_extension": {
              "type": "string"
            },
            "file_size_bytes": {
              "type": "integer"
            },
            "file_size_human": {
              "type": "string"
            },
            "mime_type": {
              "type": "string"
            },
            "created_time": {
              "type": "string"
            },
            "modified_time": {
              "type": "string"
            }
          }
        },
        "hashes": {
          "type": "object",
          "properties": {
            "sha256": {
              "type": "string"
            },
            "md5": {
              "type": "string"
            },
            "sha1": {
              "type": "string"
            }
          }
        },
        "gdrive": {
          "type": "object",
          "properties": {
            "file_id": {
              "type": "string"
            },
            "file_url": {
              "type": "string",
              "format": "uri"
            },
            "download_url": {
              "type": "string",
              "format": "uri"
            },
            "web_view_link": {
              "type": "string",
              "format": "uri"
            },
            "parent_folders": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "version": {
              "type": "string"
            }
          }
        },
        "format_specific": {
          "type": "object",
          "description": "ファイル形式固有のメタデータ"
        }
      }
    },
    "phase1_complete_analysis": {
      "type": "object",
      "description": "Phase 1完全言語化分析結果",
      "properties": {
        "complete_metadata": {
          "$ref": "#/definitions/complete_metadata"
        },
        "file_processing_result": {
          "type": "object",
          "properties": {
            "file_type": {
              "type": "string"
            },
            "processing_status": {
              "type": "string"
            },
            "content": {
              "type": "object"
            }
          }
        },
        "ai_analysis": {
          "type": "object",
          "properties": {
            "evidence_id": {
              "type": "string"
            },
            "verbalization_level": {
              "type": "integer",
              "minimum": 1,
              "maximum": 5
            },
            "confidence_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "evidence_metadata": {
              "type": "object",
              "description": "証拠の基本情報"
            },
            "full_content": {
              "type": "object",
              "description": "完全言語化された内容",
              "properties": {
                "complete_description": {
                  "type": "string"
                },
                "visual_information": {
                  "type": "object"
                },
                "textual_content": {
                  "type": "object"
                },
                "ocr_results": {
                  "type": "object"
                }
              }
            },
            "legal_significance": {
              "type": "object",
              "description": "法的意義",
              "properties": {
                "primary_significance": {
                  "type": "string"
                },
                "supporting_facts": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "legal_theories": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "relevance_to_case": {
                  "type": "string"
                }
              }
            },
            "related_facts": {
              "type": "object",
              "description": "関連する事実",
              "properties": {
                "timeline": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "related_parties": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "related_evidence": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            },
            "usage_suggestions": {
              "type": "object",
              "description": "準備書面での使用方法",
              "properties": {
                "phase2_preparation": {
                  "type": "string"
                },
                "citation_points": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "argument_strategies": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "quality_assessment": {
          "type": "object",
          "properties": {
            "verbalization_level": {
              "type": "integer"
            },
            "confidence_score": {
              "type": "number"
            },
            "completeness_score": {
              "type": "number"
            },
            "assessment_details": {
              "type": "object"
            }
          }
        },
        "analysis_timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "analysis_version": {
          "type": "object",
          "properties": {
            "system_version": {
              "type": "string"
            },
            "database_version": {
              "type": "string"
            },
            "model": {
              "type": "string"
            }
          }
        }
      }
    }
  }
}