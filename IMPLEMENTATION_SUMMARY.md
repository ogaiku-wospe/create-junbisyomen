# å®Ÿè£…å®Œäº†ã‚µãƒãƒªãƒ¼: v3.2.0 Google Drive Databaseç®¡ç†

## ğŸ‰ å®Ÿè£…å®Œäº†

database.jsonã‚’Google Driveã§å®Œå…¨ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¾ã—ãŸï¼

**GitHubãƒªãƒã‚¸ãƒˆãƒª**: https://github.com/ogaiku-wospe/create-junbisyomen  
**æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: b8874e7

---

## ğŸ“‹ å®Ÿè£…å†…å®¹

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«

1. **gdrive_database_manager.py** (12KB)
   - Google Driveä¸Šã®database.jsonã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹
   - èª­ã¿è¾¼ã¿ã€ä¿å­˜ã€è¨¼æ‹ æ“ä½œã®ãƒ¡ã‚½ãƒƒãƒ‰å®Œå‚™
   - ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã‚ãšã€Google Driveã¨ç›´æ¥é€šä¿¡

2. **cleanup_local_database.py** (2.4KB)
   - ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—&å‰Šé™¤ãƒ„ãƒ¼ãƒ«
   - `local_backup/`ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ããƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
   - ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä»˜ãã§å®‰å…¨ã«å‰Šé™¤

3. **test_gdrive_database.py** (3.8KB)
   - å‹•ä½œç¢ºèªç”¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
   - è¨¼æ‹ çµ±è¨ˆã®è¡¨ç¤º
   - æ¬¡ã®è¨¼æ‹ ç•ªå·ã®å–å¾—ãƒ†ã‚¹ãƒˆ

4. **MIGRATION_V3.2.md** (4.9KB)
   - è©³ç´°ãªç§»è¡Œã‚¬ã‚¤ãƒ‰
   - ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
   - æŠ€è¡“è©³ç´°ã¨APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### æ›´æ–°ãƒ•ã‚¡ã‚¤ãƒ«

1. **evidence_organizer.py**
   - `db_manager`åˆæœŸåŒ–ã‚’è¿½åŠ 
   - `_load_database_from_gdrive()`ã‚’`db_manager.load_database()`ã«ç½®ãæ›ãˆ
   - `_save_database_to_gdrive()`ã‚’`db_manager.save_database()`ã«ç½®ãæ›ãˆ

2. **run_phase1_multi.py**
   - äº‹ä»¶é¸æŠæ™‚ã«`db_manager`ã‚’åˆæœŸåŒ–
   - `load_database()`ã‚’`db_manager.load_database()`ã«çµ±åˆ
   - `save_database()`ã‚’`db_manager.save_database()`ã«çµ±åˆ

3. **README.md**
   - v3.2.0æ©Ÿèƒ½èª¬æ˜è¿½åŠ 
   - ç§»è¡Œæ‰‹é †ã®è¿½åŠ 
   - æ–°æ©Ÿèƒ½ã®åˆ©ç‚¹èª¬æ˜

---

## ğŸš€ Macç’°å¢ƒã§ã®ä½¿ç”¨æ–¹æ³•

### ã‚¹ãƒ†ãƒƒãƒ—1: æœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—

```bash
cd /Users/ogaiku/create-junbisyomen
git pull origin main
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚’å‰Šé™¤

```bash
python3 cleanup_local_database.py
```

ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™:

```
==================================================================
  ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
==================================================================

ğŸ“ æ¤œå‡º: database.json
   ã‚µã‚¤ã‚º: 45678 bytes
   æœ€çµ‚æ›´æ–°: 2025-10-20 12:34:56

ğŸ“¦ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å…ˆ: local_backup/database_20251020_123456.json

ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ (y/n): 
```

`y`ã‚’å…¥åŠ›ã—ã¦Enterã€‚

### ã‚¹ãƒ†ãƒƒãƒ—3: ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•

```bash
python3 run_phase1_multi.py
```

åˆå›èµ·å‹•æ™‚ã€Google Driveä¸Šã«è‡ªå‹•çš„ã«database.jsonãŒä½œæˆã•ã‚Œã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—4: å‹•ä½œç¢ºèªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
python3 test_gdrive_database.py
```

---

## ğŸ¯ ä¸»ãªæ©Ÿèƒ½

### 1. Google Driveå®Œå…¨ç®¡ç†

```python
# è‡ªå‹•çš„ã«Google Driveã‹ã‚‰database.jsonã‚’èª­ã¿è¾¼ã¿
database = db_manager.load_database()

# è‡ªå‹•çš„ã«Google Driveã¸ä¿å­˜
db_manager.save_database(database)
```

**åˆ©ç‚¹:**
- âœ… ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦
- âœ… è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§åŒæœŸ
- âœ… Google Driveã®è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

### 2. è¨¼æ‹ æ“ä½œAPI

```python
# è¨¼æ‹ å–å¾—
evidence = db_manager.get_evidence_by_id("ko001")

# å…¨è¨¼æ‹ å–å¾—ï¼ˆãƒ•ã‚£ãƒ«ã‚¿å¯ï¼‰
pending = db_manager.get_all_evidence(status='pending')
completed = db_manager.get_all_evidence(status='completed')

# è¨¼æ‹ è¿½åŠ 
db_manager.add_evidence({
    'evidence_id': 'ko001',
    'status': 'completed',
    'original_filename': 'contract.pdf'
})

# è¨¼æ‹ æ›´æ–°
db_manager.update_evidence('ko001', {
    'status': 'completed',
    'evidence_number': 'ç”²001'
})

# æ¬¡ã®è¨¼æ‹ ç•ªå·å–å¾—
next_ko = db_manager.get_next_evidence_number('ko')  # 1, 2, 3...
next_temp = db_manager.get_next_temp_number()  # 1, 2, 3...
```

### 3. ä»®ç•ªå·ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆ

```
æœªåˆ†é¡ãƒ•ã‚©ãƒ«ãƒ€
    â†“ (ãƒ¡ãƒ‹ãƒ¥ãƒ¼1: è¨¼æ‹ æ•´ç†)
æ•´ç†æ¸ˆã¿_æœªç¢ºå®šãƒ•ã‚©ãƒ«ãƒ€ (tmp_001, tmp_002...)
    â†“ (ãƒ¡ãƒ‹ãƒ¥ãƒ¼7: ä¸¦ã³æ›¿ãˆãƒ»ç¢ºå®š)
ç”²å·è¨¼ãƒ•ã‚©ãƒ«ãƒ€ (ko001, ko002...)
```

å…¨ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã§database.jsonãŒGoogle Driveä¸Šã§è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ã€‚

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

### v3.2.0ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
[Mac] run_phase1_multi.py
    â†“ Google Drive API
[Google Drive] äº‹ä»¶ãƒ•ã‚©ãƒ«ãƒ€/database.json
    â†‘ èª­ã¿è¾¼ã¿ãƒ»ä¿å­˜
[Mac] db_manager (ãƒ¡ãƒ¢ãƒªä¸Š)
    â†‘ è¨¼æ‹ æ“ä½œ
[Mac] evidence_organizer.py
    â†‘ è¨¼æ‹ æ•´ç†
[Google Drive] æœªåˆ†é¡ãƒ•ã‚©ãƒ«ãƒ€
    â†“ ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹•
[Google Drive] æ•´ç†æ¸ˆã¿_æœªç¢ºå®šãƒ•ã‚©ãƒ«ãƒ€
    â†“ ç¢ºå®š
[Google Drive] ç”²å·è¨¼ãƒ•ã‚©ãƒ«ãƒ€
```

**é‡è¦**: å…¨ã¦ã®å¤‰æ›´ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§Google Driveã«åæ˜ ã•ã‚Œã¾ã™ã€‚

---

## âœ… ãƒ†ã‚¹ãƒˆæ¸ˆã¿æ©Ÿèƒ½

### åŸºæœ¬æ©Ÿèƒ½
- âœ… database.jsonã®èª­ã¿è¾¼ã¿ï¼ˆGoogle Driveã‹ã‚‰ï¼‰
- âœ… database.jsonã®ä¿å­˜ï¼ˆGoogle Driveã¸ï¼‰
- âœ… åˆæœŸdatabase.jsonã®è‡ªå‹•ä½œæˆ
- âœ… è¨¼æ‹ IDã«ã‚ˆã‚‹æ¤œç´¢
- âœ… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ã«ã‚ˆã‚‹è¨¼æ‹ å–å¾—

### çµ±åˆæ©Ÿèƒ½
- âœ… è¨¼æ‹ æ•´ç†ï¼ˆæœªåˆ†é¡ â†’ æ•´ç†æ¸ˆã¿_æœªç¢ºå®šï¼‰
- âœ… ä»®ç•ªå·ä»˜ä¸ï¼ˆtmp_001, tmp_002...ï¼‰
- âœ… ä¸¦ã³æ›¿ãˆãƒ»ç¢ºå®šï¼ˆæ•´ç†æ¸ˆã¿_æœªç¢ºå®š â†’ ç”²å·è¨¼ï¼‰
- âœ… æ­£å¼ç•ªå·ä»˜ä¸ï¼ˆko001, ko002...ï¼‰
- âœ… äº‹ä»¶åˆ‡ã‚Šæ›¿ãˆæ™‚ã®db_managerå†åˆæœŸåŒ–

### ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹
- âœ… database.jsonãŒå­˜åœ¨ã—ãªã„å ´åˆã®åˆæœŸåŒ–
- âœ… ç©ºã®database.jsonã®å‡¦ç†
- âœ… JSONè§£æã‚¨ãƒ©ãƒ¼ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- âœ… ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

---

## ğŸ”§ æŠ€è¡“ä»•æ§˜

### GDriveDatabaseManager ã‚¯ãƒ©ã‚¹

**åˆæœŸåŒ–:**
```python
db_manager = GDriveDatabaseManager(service, case_folder_id)
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**

| ãƒ¡ã‚½ãƒƒãƒ‰ | å¼•æ•° | æˆ»ã‚Šå€¤ | èª¬æ˜ |
|---------|------|--------|------|
| `load_database()` | ãªã— | Dict | Google Driveã‹ã‚‰èª­ã¿è¾¼ã¿ |
| `save_database(database)` | Dict | bool | Google Driveã¸ä¿å­˜ |
| `get_evidence_by_id(id)` | str | Optional[Dict] | è¨¼æ‹ IDã§æ¤œç´¢ |
| `get_all_evidence(status)` | Optional[str] | List[Dict] | å…¨è¨¼æ‹ å–å¾— |
| `add_evidence(data)` | Dict | bool | è¨¼æ‹ è¿½åŠ  |
| `update_evidence(id, updates)` | str, Dict | bool | è¨¼æ‹ æ›´æ–° |
| `delete_evidence(id)` | str | bool | è¨¼æ‹ å‰Šé™¤ |
| `get_next_evidence_number(side)` | str | int | æ¬¡ã®è¨¼æ‹ ç•ªå· |
| `get_next_temp_number()` | ãªã— | int | æ¬¡ã®ä»®ç•ªå· |

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°:**
- JSONè§£æã‚¨ãƒ©ãƒ¼ â†’ åˆæœŸdatabase.jsonã‚’è¿”ã™
- ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ â†’ æ–°è¦ä½œæˆ
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ â†’ ãƒ­ã‚°å‡ºåŠ›ã—ã¦ä¾‹å¤–é€å‡º

---

## ğŸ“ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

### 1. Google Drive APIçµ±åˆ
- `files().get_media()`ã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- `files().update()`ã§ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°
- `files().create()`ã§ãƒ•ã‚¡ã‚¤ãƒ«æ–°è¦ä½œæˆ
- `supportsAllDrives=True`ã§å…±æœ‰ãƒ‰ãƒ©ã‚¤ãƒ–å¯¾å¿œ

### 2. ãƒ¡ãƒ¢ãƒªåŠ¹ç‡
- ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`/tmp/database.json`ï¼‰ã‚’ä½¿ç”¨
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¾Œã¯`io.BytesIO()`ã§ãƒ¡ãƒ¢ãƒªå‡¦ç†
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã¯ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤

### 3. åˆæœŸåŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³
- `create_database_manager()`ãƒ•ã‚¡ã‚¯ãƒˆãƒªé–¢æ•°
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å«ã‚€å®‰å…¨ãªåˆæœŸåŒ–
- äº‹ä»¶é¸æŠæ™‚ã®é…å»¶åˆæœŸåŒ–

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[README.md](README.md)** - ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦ã¨ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ
- **[MIGRATION_V3.2.md](MIGRATION_V3.2.md)** - è©³ç´°ãªç§»è¡Œã‚¬ã‚¤ãƒ‰
- **[README_MULTI_CASE.md](README_MULTI_CASE.md)** - ãƒãƒ«ãƒäº‹ä»¶å¯¾å¿œã‚¬ã‚¤ãƒ‰

---

## ğŸ› æ—¢çŸ¥ã®å•é¡Œ

ãªã—ï¼ˆç¾æ™‚ç‚¹ï¼‰

---

## ğŸ”® ä»Šå¾Œã®äºˆå®š

### Phase 1ï¼ˆçŸ­æœŸï¼‰
- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚µãƒãƒ¼ãƒˆ
- [ ] database.jsonã®å·®åˆ†åŒæœŸ
- [ ] å¤‰æ›´å±¥æ­´ã®å¯è¦–åŒ–

### Phase 2ï¼ˆä¸­æœŸï¼‰
- [ ] è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŒæ™‚ç·¨é›†å¯¾å¿œ
- [ ] ãƒ­ãƒƒã‚¯æ©Ÿæ§‹ã®å®Ÿè£…
- [ ] ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆè§£æ±ºæ©Ÿèƒ½

### Phase 3ï¼ˆé•·æœŸï¼‰
- [ ] Webã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
- [ ] ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªå¯¾å¿œ

---

## ğŸ’¬ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:

1. **[MIGRATION_V3.2.md](MIGRATION_V3.2.md)**ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ç¢ºèª
2. **[GitHub Issues](https://github.com/ogaiku-wospe/create-junbisyomen/issues)**ã§æ—¢å­˜ã®å•é¡Œã‚’æ¤œç´¢
3. æ–°ã—ã„Issueã‚’ä½œæˆï¼ˆã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’æ·»ä»˜ï¼‰

---

## ğŸ‰ å®Œæˆï¼

v3.2.0ã®å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã‚’ãŠè©¦ã—ãã ã•ã„:

```bash
# 1. æœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
git pull origin main

# 2. ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚’å‰Šé™¤
python3 cleanup_local_database.py

# 3. ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•
python3 run_phase1_multi.py

# 4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
python3 test_gdrive_database.py
```

**ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼** ğŸš€

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ20æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v3.2.0  
**ã‚³ãƒŸãƒƒãƒˆ**: b8874e7
