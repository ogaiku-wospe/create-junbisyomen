# v3.2.0 ç§»è¡Œã‚¬ã‚¤ãƒ‰ - database.jsonã®Google Driveç®¡ç†

## ğŸ“‹ æ¦‚è¦

v3.2.0ã‹ã‚‰ã€database.jsonã‚’Google Driveã§ç®¡ç†ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ã®ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™:

- âœ… **è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§åŒæœŸ**: Macã€Windowsã€Linuxã‹ã‚‰åŒã˜ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹
- âœ… **è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: Google Driveã®è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ã‚’åˆ©ç”¨
- âœ… **ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸è¦**: ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã‚’ç¯€ç´„
- âœ… **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**: æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã«å¸¸ã«ã‚¢ã‚¯ã‚»ã‚¹

## ğŸ”„ ç§»è¡Œæ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: æœ€æ–°ç‰ˆã‚’å–å¾—

```bash
cd /Users/ogaiku/create-junbisyomen
git pull origin main
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦å‰Šé™¤

```bash
python3 cleanup_local_database.py
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯:
- ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚’ `local_backup/` ãƒ•ã‚©ãƒ«ãƒ€ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
- ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤º

### ã‚¹ãƒ†ãƒƒãƒ—3: ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•

```bash
python3 run_phase1_multi.py
```

åˆå›èµ·å‹•æ™‚:
1. äº‹ä»¶ã‚’é¸æŠã¾ãŸã¯æ–°è¦ä½œæˆ
2. Google Driveä¸Šã®äº‹ä»¶ãƒ•ã‚©ãƒ«ãƒ€å†…ã«database.jsonãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã™
3. ä»¥é™ã€å…¨ã¦ã®èª­ã¿æ›¸ãã¯Google Driveã§ç›´æ¥å®Ÿè¡Œã•ã‚Œã¾ã™

## ğŸ¯ æ–°ã—ã„å‹•ä½œ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å ´æ‰€

**ä»¥å‰ï¼ˆv3.1.xï¼‰:**
```
/Users/ogaiku/create-junbisyomen/database.json  â† ãƒ­ãƒ¼ã‚«ãƒ«
```

**ç¾åœ¨ï¼ˆv3.2.0ï¼‰:**
```
Google Drive/
â””â”€â”€ å…±æœ‰ãƒ‰ãƒ©ã‚¤ãƒ–/
    â””â”€â”€ meiyokison_åèª‰æ¯€æäº‹ä»¶/
        â””â”€â”€ database.json  â† Google Driveä¸Š
```

### èª­ã¿è¾¼ã¿ãƒ»ä¿å­˜ã®å‹•ä½œ

**ä»¥å‰:**
1. ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚’èª­ã¿è¾¼ã¿
2. Google Driveã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**ç¾åœ¨:**
1. Google Driveã‹ã‚‰ç›´æ¥èª­ã¿è¾¼ã¿
2. Google Driveã«ç›´æ¥ä¿å­˜
3. ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—

## ğŸ” æŠ€è¡“è©³ç´°

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«

#### `gdrive_database_manager.py`

Google Driveä¸Šã®database.jsonã‚’ç®¡ç†ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹:

```python
from gdrive_database_manager import GDriveDatabaseManager, create_database_manager

# åˆæœŸåŒ–
db_manager = create_database_manager(case_manager, case_info)

# èª­ã¿è¾¼ã¿
database = db_manager.load_database()

# ä¿å­˜
db_manager.save_database(database)

# è¨¼æ‹ ã®å–å¾—
evidence = db_manager.get_evidence_by_id('ko001')

# è¨¼æ‹ ã®è¿½åŠ 
db_manager.add_evidence(evidence_data)
```

ä¸»ãªãƒ¡ã‚½ãƒƒãƒ‰:
- `load_database()`: Google Driveã‹ã‚‰database.jsonã‚’èª­ã¿è¾¼ã¿
- `save_database(database)`: Google Driveã«database.jsonã‚’ä¿å­˜
- `get_evidence_by_id(evidence_id)`: IDã§è¨¼æ‹ ã‚’å–å¾—
- `get_all_evidence(status)`: å…¨è¨¼æ‹ ã‚’å–å¾—ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿å¯èƒ½ï¼‰
- `add_evidence(evidence_data)`: è¨¼æ‹ ã‚’è¿½åŠ 
- `update_evidence(evidence_id, updates)`: è¨¼æ‹ ã‚’æ›´æ–°
- `delete_evidence(evidence_id)`: è¨¼æ‹ ã‚’å‰Šé™¤
- `get_next_evidence_number(side)`: æ¬¡ã®è¨¼æ‹ ç•ªå·ã‚’å–å¾—
- `get_next_temp_number()`: æ¬¡ã®ä»®ç•ªå·ã‚’å–å¾—

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

#### `evidence_organizer.py`

- `GDriveDatabaseManager`ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- åˆæœŸåŒ–æ™‚ã«`self.db_manager`ã‚’ä½œæˆ
- `_load_database_from_gdrive()`ã¨`_save_database_to_gdrive()`ã‚’ã‚·ãƒ³ãƒ—ãƒ«åŒ–

#### `run_phase1_multi.py`

- `GDriveDatabaseManager`ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- `self.db_manager`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
- äº‹ä»¶é¸æŠ/ä½œæˆæ™‚ã«`db_manager`ã‚’åˆæœŸåŒ–
- `load_database()`ã¨`save_database()`ã‚’ã‚·ãƒ³ãƒ—ãƒ«åŒ–

## âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …

### 1. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒå¿…è¦

database.jsonã®èª­ã¿æ›¸ãã«ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒå¿…è¦ã§ã™ã€‚ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç’°å¢ƒã§ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚

### 2. Google Drive APIã®åˆ¶é™

Google Drive APIã«ã¯ä»¥ä¸‹ã®åˆ¶é™ãŒã‚ã‚Šã¾ã™:
- 1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Š1æ—¥1,000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- èª­ã¿å–ã‚Š: 1ç§’ã‚ãŸã‚Š10ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- æ›¸ãè¾¼ã¿: 1ç§’ã‚ãŸã‚Š10ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

é€šå¸¸ã®ä½¿ç”¨ã§ã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€å¤§é‡ã®è¨¼æ‹ ã‚’ä¸€åº¦ã«å‡¦ç†ã™ã‚‹å ´åˆã¯æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

### 3. åŒæ™‚ç·¨é›†ã®åˆ¶å¾¡

è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰åŒæ™‚ã«åŒã˜database.jsonã‚’ç·¨é›†ã™ã‚‹ã¨ã€æœ€å¾Œã®ä¿å­˜ãŒä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚
è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§ä½œæ¥­ã™ã‚‹å ´åˆã¯ã€æ™‚é–“ã‚’ãšã‚‰ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

### 4. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®é‡è¦æ€§

Google Driveã«ä¾å­˜ã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’æ¨å¥¨ã—ã¾ã™:

```bash
# å®šæœŸçš„ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
python3 run_phase1_multi.py
# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€Œ5. database.jsonã®çŠ¶æ…‹ç¢ºèªã€ã‚’é¸æŠ
```

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q1: `âŒ Google Driveèªè¨¼ãŒå¿…è¦ã§ã™`

**åŸå› **: credentials.jsonãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€ã¾ãŸã¯tokenãŒæœŸé™åˆ‡ã‚Œ

**è§£æ±ºç­–**:
```bash
# tokenã‚’å‰Šé™¤ã—ã¦å†èªè¨¼
rm token.pickle
python3 run_phase1_multi.py
```

### Q2: `âŒ database.jsonèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼`

**åŸå› **: Google Driveä¸Šã®database.jsonãŒç ´æã—ã¦ã„ã‚‹

**è§£æ±ºç­–**:
1. ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ:
```bash
# local_backup/ ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒã‚ã‚‹ã‹ç¢ºèª
ls local_backup/

# æœ€æ–°ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ç¢ºèª
python3 -c "
import json
with open('local_backup/database_YYYYMMDD_HHMMSS.json') as f:
    data = json.load(f)
    print('âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ­£å¸¸ã§ã™')
"
```

2. æ‰‹å‹•ã§Google Driveã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

### Q3: `âš ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–ã«å¤±æ•—`

**åŸå› **: äº‹ä»¶ãƒ•ã‚©ãƒ«ãƒ€IDãŒæ­£ã—ããªã„ã€ã¾ãŸã¯Google Driveèªè¨¼ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–**:
1. global_config.pyã®SHARED_DRIVE_ROOT_IDã‚’ç¢ºèª
2. Google Drive APIãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. credentials.jsonãŒæ­£ã—ãé…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### Q4: ãƒ­ãƒ¼ã‚«ãƒ«ã¨Google Driveã®ãƒ‡ãƒ¼ã‚¿ãŒç•°ãªã‚‹

**åŸå› **: å¤ã„ãƒ­ãƒ¼ã‚«ãƒ«database.jsonãŒæ®‹ã£ã¦ã„ã‚‹

**è§£æ±ºç­–**:
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚’å‰Šé™¤
rm database.json

# ã‚·ã‚¹ãƒ†ãƒ ã‚’å†èµ·å‹•
python3 run_phase1_multi.py
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿

### èª­ã¿è¾¼ã¿æ™‚é–“

- **ãƒ­ãƒ¼ã‚«ãƒ«ï¼ˆv3.1.xï¼‰**: ã€œ10ms
- **Google Driveï¼ˆv3.2.0ï¼‰**: ã€œ200-500ms

database.jsonã®ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚‹ã¨ã€Google Driveã‹ã‚‰ã®èª­ã¿è¾¼ã¿ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

### å¯¾ç­–

å°†æ¥çš„ã«ä»¥ä¸‹ã®æœ€é©åŒ–ã‚’æ¤œè¨:
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Ÿè£…ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] å·®åˆ†æ›´æ–°ã®å®Ÿè£…
- [ ] ãƒãƒƒãƒå‡¦ç†ã®æœ€é©åŒ–

## ğŸ”® ä»Šå¾Œã®äºˆå®š

### v3.3.0ï¼ˆäºˆå®šï¼‰
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³å®Ÿè£…
- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã®ã‚µãƒãƒ¼ãƒˆ
- [ ] åŒæ™‚ç·¨é›†ã®ç«¶åˆè§£æ±ºæ©Ÿèƒ½

### v3.4.0ï¼ˆäºˆå®šï¼‰
- [ ] database.jsonã®è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
- [ ] ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®å¼·åŒ–

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:
1. ã“ã®ã‚¬ã‚¤ãƒ‰ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ç¢ºèª
2. [GitHub Issues](https://github.com/ogaiku-wospe/create-junbisyomen/issues) ã‚’æ¤œç´¢
3. æ–°ã—ã„Issueã‚’ä½œæˆ

---

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.2.0  
**æœ€çµ‚æ›´æ–°**: 2025å¹´10æœˆ20æ—¥
