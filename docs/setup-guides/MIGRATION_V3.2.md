# v3.2.0 ç§»è¡Œã‚¬ã‚¤ãƒ‰: database.jsonã‚’Google Driveã§ç®¡ç†

## ğŸ“‹ æ¦‚è¦

v3.2.0ã‹ã‚‰ã€database.jsonã¯å®Œå…¨ã«Google Driveã§ç®¡ç†ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸è¦ã§ã™ã€‚

### ğŸ¯ ä¸»ãªå¤‰æ›´ç‚¹

1. **Google Driveå®Œå…¨ç®¡ç†**: database.jsonã¯äº‹ä»¶ãƒ•ã‚©ãƒ«ãƒ€å†…ã§ç®¡ç†
2. **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«å»ƒæ­¢**: ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã¯ä¸è¦
3. **ãƒãƒ«ãƒãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ**: è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§åŒã˜ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹
4. **è‡ªå‹•åŒæœŸ**: Google Driveã®è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ã‚’æ´»ç”¨

## ğŸš€ ç§»è¡Œæ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: æœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—

```bash
cd /Users/ogaiku/create-junbisyomen
git pull origin main
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦å‰Šé™¤

```bash
python3 cleanup_local_database.py
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™:
- ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚’`local_backup/`ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
- ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤º

**å®Ÿè¡Œä¾‹:**
```
==================================================================
  ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
==================================================================

ğŸ“ æ¤œå‡º: database.json
   ã‚µã‚¤ã‚º: 45678 bytes
   æœ€çµ‚æ›´æ–°: 2025-10-20 12:34:56

ğŸ“¦ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å…ˆ: local_backup/database_20251020_123456.json

ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ (y/n): y

âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: local_backup/database_20251020_123456.json
âœ… ãƒ­ãƒ¼ã‚«ãƒ«database.jsonå‰Šé™¤å®Œäº†

==================================================================
  ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†
==================================================================

ğŸ“ ä»Šå¾Œã«ã¤ã„ã¦:
  - database.jsonã¯Google Driveã§ç®¡ç†ã•ã‚Œã¾ã™
  - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸è¦ã«ãªã‚Šã¾ã—ãŸ
  - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯ local_backup/ ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™
```

### ã‚¹ãƒ†ãƒƒãƒ—3: ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•

```bash
python3 run_phase1_multi.py
```

åˆå›èµ·å‹•æ™‚ã€Google Driveä¸Šã«è‡ªå‹•çš„ã«database.jsonãŒä½œæˆã•ã‚Œã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—4: å‹•ä½œç¢ºèªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
python3 test_gdrive_database.py
```

ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ä»¥ä¸‹ã‚’ç¢ºèª:
- Google Driveã‹ã‚‰ã®èª­ã¿è¾¼ã¿
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã®æ¤œè¨¼
- è¨¼æ‹ çµ±è¨ˆã®è¡¨ç¤º

## ğŸ“Š æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### v3.1.0ä»¥å‰ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†ï¼‰

```
ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•
    â†“
ãƒ­ãƒ¼ã‚«ãƒ«database.jsonèª­ã¿è¾¼ã¿
    â†“
è¨¼æ‹ åˆ†æãƒ»æ•´ç†
    â†“
ãƒ­ãƒ¼ã‚«ãƒ«database.jsonä¿å­˜
    â†“
ï¼ˆGoogle Driveã¨ã®åŒæœŸãªã—ï¼‰
```

### v3.2.0ä»¥é™ï¼ˆGoogle Driveç®¡ç†ï¼‰

```
ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•
    â†“
Google Driveèªè¨¼
    â†“
database.jsonèª­ã¿è¾¼ã¿ï¼ˆGoogle Driveã‹ã‚‰ï¼‰
    â†“
è¨¼æ‹ åˆ†æãƒ»æ•´ç†
    â†“
database.jsonä¿å­˜ï¼ˆGoogle Driveã¸ï¼‰
    â†“
âœ… è‡ªå‹•çš„ã«ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã‚‚åˆ©ç”¨å¯èƒ½
```

## ğŸ”§ æŠ€è¡“è©³ç´°

### GDriveDatabaseManager ã‚¯ãƒ©ã‚¹

æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸ`gdrive_database_manager.py`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«:

```python
from gdrive_database_manager import GDriveDatabaseManager, create_database_manager

# ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ä½œæˆ
db_manager = create_database_manager(case_manager, case_info)

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èª­ã¿è¾¼ã¿
database = db_manager.load_database()

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜
db_manager.save_database(database)

# è¨¼æ‹ æ“ä½œ
evidence = db_manager.get_evidence_by_id("ko001")
all_pending = db_manager.get_all_evidence(status='pending')
next_number = db_manager.get_next_evidence_number('ko')
```

### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|---------|------|
| `load_database()` | Google Driveã‹ã‚‰èª­ã¿è¾¼ã¿ |
| `save_database(database)` | Google Driveã¸ä¿å­˜ |
| `get_evidence_by_id(id)` | è¨¼æ‹ IDã§æ¤œç´¢ |
| `get_all_evidence(status)` | å…¨è¨¼æ‹ å–å¾—ï¼ˆãƒ•ã‚£ãƒ«ã‚¿å¯ï¼‰ |
| `add_evidence(data)` | è¨¼æ‹ è¿½åŠ  |
| `update_evidence(id, updates)` | è¨¼æ‹ æ›´æ–° |
| `delete_evidence(id)` | è¨¼æ‹ å‰Šé™¤ |
| `get_next_evidence_number(side)` | æ¬¡ã®è¨¼æ‹ ç•ªå·å–å¾— |
| `get_next_temp_number()` | æ¬¡ã®ä»®ç•ªå·å–å¾— |

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

1. **gdrive_database_manager.py** (æ–°è¦)
   - Google Driveä¸Šã®database.jsonç®¡ç†ã‚¯ãƒ©ã‚¹

2. **evidence_organizer.py**
   - `db_manager`ã‚’åˆæœŸåŒ–ã«è¿½åŠ 
   - `_load_database_from_gdrive()`ã‚’`db_manager.load_database()`ã«ç½®ãæ›ãˆ
   - `_save_database_to_gdrive()`ã‚’`db_manager.save_database()`ã«ç½®ãæ›ãˆ

3. **run_phase1_multi.py**
   - `db_manager`ã‚’åˆæœŸåŒ–ã«è¿½åŠ ï¼ˆäº‹ä»¶é¸æŠå¾Œï¼‰
   - `load_database()`ã‚’`db_manager.load_database()`ã«ç½®ãæ›ãˆ
   - `save_database()`ã‚’`db_manager.save_database()`ã«ç½®ãæ›ãˆ

4. **cleanup_local_database.py** (æ–°è¦)
   - ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—&å‰Šé™¤ãƒ„ãƒ¼ãƒ«

5. **test_gdrive_database.py** (æ–°è¦)
   - å‹•ä½œç¢ºèªç”¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

## ğŸ’¡ åˆ©ç‚¹

### 1. ãƒãƒ«ãƒãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ
- è‡ªå®…ã®PCã€è·å ´ã®PCã€ãƒãƒ¼ãƒˆPCã§åŒã˜ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§

### 2. è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- Google Driveã®ç‰ˆç®¡ç†æ©Ÿèƒ½ã‚’æ´»ç”¨
- ãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æã—ã¦ã‚‚GoogleãŒè‡ªå‹•ã§å¾©å…ƒ

### 3. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ã®å®¹é‡ã‚’ç¯€ç´„
- å¤§è¦æ¨¡ãªè¨¼æ‹ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã‚‚å•é¡Œãªã—

### 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- Google Driveã®å¼·å›ºãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- æš—å·åŒ–é€šä¿¡ã§å®‰å…¨ã«ã‚¢ã‚¯ã‚»ã‚¹

## âš ï¸ æ³¨æ„äº‹é …

### ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒå¿…è¦
- database.jsonã®èª­ã¿æ›¸ãã«ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒå¿…è¦
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã¯å‹•ä½œã—ã¾ã›ã‚“

### åˆå›èµ·å‹•æ™‚ã®èªè¨¼
- Google Drive APIã®èªè¨¼ãŒå¿…è¦
- `credentials.json`ãŒå¿…è¦ï¼ˆåˆå›ã®ã¿ï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚ˆã‚Šã‚ãšã‹ã«é…ã„ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ï¼‰
- é€šå¸¸ã®ä½¿ç”¨ã§ã¯å•é¡Œãªã„ãƒ¬ãƒ™ãƒ«

## ğŸ”™ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ–¹æ³•

v3.1.0ã«æˆ»ã™å ´åˆ:

```bash
# å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
git checkout a9978ae

# ã¾ãŸã¯ç‰¹å®šã®ã‚³ãƒŸãƒƒãƒˆã«æˆ»ã™
git revert HEAD

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
cp local_backup/database_*.json database.json
```

## ğŸ“ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q1: "database.jsonæ¤œç´¢ã‚¨ãƒ©ãƒ¼"ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**åŸå› **: Google Drive APIã®èªè¨¼ã«å¤±æ•—

**è§£æ±ºç­–**:
1. `credentials.json`ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
2. `token.json`ã‚’å‰Šé™¤ã—ã¦å†èªè¨¼: `rm token.json`
3. ã‚·ã‚¹ãƒ†ãƒ ã‚’å†èµ·å‹•

### Q2: ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œãªã„

**åŸå› **: ç•°ãªã‚‹äº‹ä»¶ãƒ•ã‚©ãƒ«ãƒ€ã‚’å‚ç…§ã—ã¦ã„ã‚‹å¯èƒ½æ€§

**è§£æ±ºç­–**:
1. ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€Œ6. äº‹ä»¶ã‚’åˆ‡ã‚Šæ›¿ãˆã€ã‚’é¸æŠ
2. æ­£ã—ã„äº‹ä»¶ã‚’é¸æŠ
3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèª

### Q3: ä¿å­˜ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹

**åŸå› **: Google Driveã®å®¹é‡ä¸è¶³ã¾ãŸã¯æ¨©é™ä¸è¶³

**è§£æ±ºç­–**:
1. Google Driveã®å®¹é‡ã‚’ç¢ºèª
2. å…±æœ‰ãƒ‰ãƒ©ã‚¤ãƒ–ã®æ›¸ãè¾¼ã¿æ¨©é™ã‚’ç¢ºèª
3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèª

### Q4: ãƒ­ãƒ¼ã‚«ãƒ«database.jsonã¨ã®ä¸æ•´åˆ

**åŸå› **: ç§»è¡Œå‰ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ®‹ã£ã¦ã„ã‚‹

**è§£æ±ºç­–**:
1. `cleanup_local_database.py`ã‚’å®Ÿè¡Œ
2. `local_backup/`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèª
3. å¿…è¦ã«å¿œã˜ã¦Google Driveä¸Šã®database.jsonã‚’æ‰‹å‹•æ›´æ–°

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [README.md](README.md) - ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦
- [README_MULTI_CASE.md](README_MULTI_CASE.md) - ãƒãƒ«ãƒäº‹ä»¶å¯¾å¿œã‚¬ã‚¤ãƒ‰
- [USAGE_GUIDE.md](USAGE_GUIDE.md) - è©³ç´°ãªä½¿ç”¨æ–¹æ³•

## ğŸ¯ ä»Šå¾Œã®äºˆå®š

- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã®ã‚µãƒãƒ¼ãƒˆï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ï¼‰
- [ ] database.jsonã®å·®åˆ†åŒæœŸ
- [ ] è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŒæ™‚ç·¨é›†å¯¾å¿œ
- [ ] å¤‰æ›´å±¥æ­´ã®å¯è¦–åŒ–

---

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.2.0  
**ãƒªãƒªãƒ¼ã‚¹æ—¥**: 2025å¹´10æœˆ20æ—¥  
**äº’æ›æ€§**: v3.1.0ä»¥é™ã®ã‚·ã‚¹ãƒ†ãƒ ã§å‹•ä½œ
